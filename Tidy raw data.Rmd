---
title: "Tidy raw data"
output: github_document
---

```{r include=FALSE}
library(tidyverse)

raw_data = read_csv("raw_data.csv")

tidy_data = raw_data %>% 
 janitor::clean_names() %>% 
 select(license_type, breed, color, owner_zip, valid_date)
 
```

# license_type

In terms of the license type, we delete three types: "Dog Lifetime Duplicate", "Dog Out of County Transfer - Lifetime", "Dog Inter County Transfer - Lifetime". We mainly focus on the remaining four types of licenses with male and female numbers combined together.

```{r}
tidy_data = 
 tidy_data %>% 
 filter(!(license_type %in% c("Dog Lifetime Duplicate", "Dog Out of County Transfer - Lifetime", "Dog Inter County Transfer - Lifetime"))) %>% 
  mutate(
    license_type = str_replace(license_type, "Male", ""),
    license_type = str_replace(license_type, "Female", "")
  )

```

# breed
We separate the breed into two types, mixed and pure. All the breeds whose name contains "mix" are belong to mixed. Others are pure.

```{r}
tidy_data = tidy_data %>% 
  mutate(
    breed_type = ifelse(str_detect(breed, "MIX"), "MIXED", "PURE")
  )
```

# Color

Due to the large quantity of the dataset, the number of "." and "OTHER" is comparatively less so we decide to delete them. Values of "BLACK WITH WHITE" sounds equal to the value of "WHITE/BLACK", hence, we recode them to be the same. Since there are various color types, we are able to look for the TOP 5~10 colors as well as proportion of the number of colors. In this case, we suggest that "MULTI", "TRI-COLOR" and other specific 3 colors to be having 3+ colors then we create a new variable "ncolor" to reserve these information.

```{r}
tidy_data = tidy_data %>% 
  drop_na(color) %>% 
  filter(color != "." & color != "OTHER") %>% 
  mutate(color = recode(color, `BLACK WITH WHITE` = "WHITE/BLACK", 
                        `MULTI` = "MULTI//", `TRI-COLOR` = "TRI-COLOR//"),
    ncolor = str_count(color, pattern = "/") + 1,
    ncolor = as.character(ncolor),
    ncolor = recode(ncolor, `3` = "3+"))
```

# zipcode

There is some zipcode that are not in Allegheny County, such as 16229, 46845 and so on. We only select zipcode of cities that belong to Allegheny County

```{r}
tidy_data = tidy_data %>% 
  filter(owner_zip < 16000)
```

# Validdate

We remained the years of the data and convert the specific time to AM and PM:

```{r}
validdate = tidy_data %>% 
  drop_na(valid_date) 

validdate_df =  as.character(validdate$valid_date) 
validdate_df =  tibble(validdate_df)

tidy_validdata_df =
  validdate_df %>%
  separate(validdate_df, into = c("Date","Time"), sep = 11)

time_PM = 
  tidy_validdata_df %>%
  separate(Time, into = c("Time","min_sec"), sep = 2) %>%
  select(Date,  Time) %>%
  filter(Time>12) %>%  
  filter(Time != "00")%>%
  mutate(time_PM, Time = "PM") %>%
  select(Date, Time) %>%
  separate(Date, into = c("Year", "Month_Day"), sep = 4) %>%
  select(Year, Time)

time_AM = 
  tidy_validdata_df %>%
  separate(Time, into = c("Time","min_sec"), sep = 2) %>%
  select(Date,  Time) %>%
  filter(Time<12) %>%  
  filter(Time != "00")%>%
  mutate(time_AM, Time = "AM") %>%
  select(Date, Time) %>%
  separate(Date, into = c("Year", "Month_Day"), sep = 4) %>%
  select(Year, Time)

time_NA = 
  tidy_validdata_df %>%
  separate(Time, into = c("Time","min_sec"), sep = 2) %>%
  select(Date,  Time) %>%
  filter(Time=="00") %>%
  mutate(time_NA, Time = "NA")  %>%
  select(Date, Time) %>%
  separate(Date, into = c("Year", "Month_Day"), sep = 4) %>%
  select(Year, Time)

tidy_validdate = combine(time_AM, time_PM, time_NA)
```

